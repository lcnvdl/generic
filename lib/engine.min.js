Function.prototype.bind&&("object"==typeof console||"function"==typeof console)&&"object"==typeof console.log&&"log info warn error assert dir clear profile profileEnd".split(" ").forEach(function(a){console[a]=this.call(console[a],console)},Function.prototype.bind);
window.log||(window.log=function(){var a,b,c=arguments,d=!1;log.history=log.history||[];log.history.push(arguments);log.detailPrint&&log.needDetailPrint&&(a=navigator.userAgent,b=/Windows\sNT\s(\d+\.\d+)/,console&&console.log&&/MSIE\s(\d+)/.test(a)&&b.test(a)&&6.1<=parseFloat(b.exec(a)[1])&&(d=!0));if(d||"undefined"!=typeof console&&"function"==typeof console.log)if(log.detailPrint&&log.needDetailPrint&&log.needDetailPrint()){console.log("-----------------");c=log.detailPrint(c);for(a=0;a<c.length;)console.log(c[a]),
a++}else 1===Array.prototype.slice.call(c).length&&"string"==typeof Array.prototype.slice.call(c)[0]?console.log(Array.prototype.slice.call(c).toString()):console.log(Array.prototype.slice.call(c));else if(!Function.prototype.bind&&"undefined"!=typeof console&&"object"==typeof console.log)if(log.detailPrint){Function.prototype.call.call(console.log,console,Array.prototype.slice.call(["-----------------"]));c=log.detailPrint(c);for(a=0;a<c.length;)Function.prototype.call.call(console.log,console,Array.prototype.slice.call([c[a]])),
a++}else Function.prototype.call.call(console.log,console,Array.prototype.slice.call(c));else document.getElementById("firebug-lite")?setTimeout(function(){window.log.apply(window,c)},500):(a=document.createElement("script"),a.type="text/javascript",a.id="firebug-lite",a.src="https://getfirebug.com/firebug-lite.js",document.getElementsByTagName("HEAD")[0].appendChild(a),setTimeout(function(){window.log.apply(window,c)},2E3))});var GE=GE||{};GE.defaults={LISTENER_PREFIX:"gengine_ev_",MAX_PLAYERS:1};
GE.Debug=!1;GE.jQuery=jQuery||$;if(!GE.jQuery)throw"jQuery is required.";if("undefined"===typeof dejavu)throw"dejavu is required.";GE.Klass=dejavu.Class.declare;GE.Abstract=dejavu.AbstractClass.declare;GE.Interface=dejavu.Interface.declare;GE.is=function(a,b){return dejavu.instanceOf(a,b)};GE.isEntity=function(a){return GE.is(a,GE.Entity)};Object.keys||(Object.keys=function(a){var b=[],c;for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b});
GE.using=function(a,b){if("string"!==typeof b)throw"GE.using(Object, String)";if(window[b])throw"Global "+b+" already exists";window[b]=AGE.Res.Model};GE.efp=GE.entityFromParam=function(a){var b=GE.engine.getCurrentScene();return"string"===typeof a?b.findObject(a):"number"===typeof a?b.getObject(a):a};GE.sizeOf=function(a){if("array"===typeof a)return a.length;var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};
GE.loadScript=function(a){GE.Debug&&console.log("Getting script: "+a);return GE.jQuery.ajax({url:a,dataType:"script",cache:!0})};Math.lerp=Math.lerp||function(a,b,c){return a+c*(b-a)};Math.toRad=Math.toRad||function(a){return a*Math.PI/180};Math.toDeg=Math.toDeg||function(a){return 180*a/Math.PI};Math.sign=Math.sign||function(a){return"number"==typeof a?a?0>a?-1:1:isNaN(a)?NaN:0:NaN};Math.sqr=Math.sqr||function(a){return a*a};
Math.choose=Math.choose||function(){var a;if(1<arguments.length)a=arguments;else if(GE.jQuery.isArray(arguments[0]))a=arguments[0];else return arguments[0];return a[Math.floor(Math.random()*a.length)]};Math.dist=Math.dist||function(a,b,c,d){return Math.sqrt(Math.sqr(c-a)+Math.sqr(d-b))};Math.dist3=Math.dist3||function(a,b,c,d,e,h){return Math.sqrt(Math.sqr(d-a)+Math.sqr(e-b)+Math.sqr(h-c))};Math.angle=Math.angle||function(a,b,c,d){throw"Not implemented";};
Math.angle3=Math.angle||function(a,b,c,d,e,h){throw"Not implemented";};GE.Misc={getRandomColor:function(){return Math.floor(16777215*Math.random())},wrapText:function(a,b,c){b=b.split(" ");for(var d="",e="",h=0;h<b.length;h++){var f=d+b[h]+" ";a.measureText(f).width>c&&0<h?(e+=d+"\n",d=b[h]+" "):d=f}return e+d}};GE.String={count:function(a,b,c){a+="";b+="";if(0>=b.length)return a.length+1;var d=0,e=0;for(c=c?1:b.length;;)if(e=a.indexOf(b,e),0<=e)d++,e+=c;else break;return d}};
GE.IIdentificable=GE.Interface({$name:"IIdentificable",getId:function(){},getUId:function(){}});
GE.Event=GE.Klass({$name:"Event",__objects:{},__subscriptions:{},initialize:function(){},add:function(a,b,c){this.__objects[a]=b;"undefined"===typeof this.__subscriptions[a]&&(this.__subscriptions[a]=[]);this.__subscriptions[a].push(c)},remove:function(a){delete this.__objects[a];delete this.__subscriptions[a]},run:function(a){var b=[],c=this;GE.jQuery.each(this.__subscriptions,function(d,h){var f=c.__objects[d];if(f)for(var g=0;g<h.length;g++)h[g].call(f,a);else b.push(d)});for(var d=0;d<b.length;d++)this.remove(b[d])}});
GE.EventManager=GE.Klass({events:{},haveTrigger:function(a){return"undefined"!==typeof this.events[a]},on:function(a,b,c,d){"function"===typeof b&&!c&&!d?(d=b,c=a,a=this.__parseId(this),b=this):"string"!==typeof a&&(d=c,c=b,b=a,a=this.__parseId(a));this.haveTrigger(c)||(this.events[c]=new GE.Event);this.events[c].add(a,b,d);return this},off:function(a,b){"undefined"===typeof b&&(b=a,a="_");a=this.__parseId(a);if("all"==b)throw"Not implemented.";if("all"==a){var c=this;GE.jQuery.each(this.events,function(b,
d){c.off(a,b)});return this}var d=this.events[b];if(d)d.remove(a);else throw"Unknown event: "+b;return this},trigger:function(a,b){var c=this.events[a];c&&c.run(b);return this},__parseId:function(a){"string"!==typeof a&&(GE.is(a,GE.IIdentificable)?a=a.getUId():(a="_",console.warn("Unknown type for ID")));return a}});
GE.Events={Engine:{READY:"gengine-ready",START:"gengine-start",STOP:"gengine-stop",PREUPDATE:"gengine-preupdt",UPDATE:"gengine-update",POSUPDATE:"gengine-postupdt",REDRAW:"gengine-redraw"},Scene:{START:"scn-start",CHANGE:"scn-change"},Entity:{CREATE:"entity-create",DESTROY:"entity-destroy"},Resource:{LOAD_FAIL:"res-fail",LOAD_SUCCESS:"res-success",LOAD_FINISH:"res-finish"},Generic:{DISPOSE:"ev-dispose"},Com:{}};
GE.Engine=GE.Klass(GE.EventManager,{$name:"Engine",$locked:!1,$statics:{idCounter:0,incrementId:function(){return++GE.Engine.$static.idCounter}},currentScene:null,changeScene:null,scenes:{},modules:{},input:null,initialize:function(){GE.engine=this;this.input=new GE.InputManager},start:function(a,b){GE.Debug&&console.log("DEBUG MODE ON");this.input.detectDevices();this.changeScene=a;var c=0,d=function(a){GE.Debug&&console.log("Loaded '"+a+"'");0==--c&&b&&(GE.Debug&&console.log("Async load finished"),
b())};GE.jQuery.each(this.modules,function(a,b){GE.Debug&&console.log('Loading module "'+a+'"...');try{if(b.async){c++;try{b.load(d,d)}catch(f){throw c--,f;}}else b.load(),GE.Debug&&console.log('Loaded "'+b.name+'"')}catch(g){console.error('Error loading module "undefined".'+(GE.Debug?" "+g:""))}});return this},update:function(a){if(this.currentScene!=this.changeScene){var b=this.currentScene?this.getCurrentScene().change(this.changeScene,a):{},c=this.getScene(this.changeScene);if(null==c)throw a=
this.changeScene,this.changeScene=this.currentScene,"Error, scene "+a+" not found";c.start(b);this.currentScene=this.changeScene}this.trigger(GE.Events.Engine.PREUPDATE,a);this.trigger(GE.Events.Engine.UPDATE,a);this.trigger(GE.Events.Engine.POSUPDATE,a)},stop:function(){return this},addModule:function(a){this.modules[a.name]=a;return this},setScenes:function(a){if(GE.jQuery.isArray(a))for(var b=0;b<a.length;b++){var c=a[b];this.scenes[c.name]=c}else this.scenes=GE.jQuery.extend({},this.scenes,a);
return this},getScene:function(a){return this.scenes[a]},getCurrentScene:function(){return this.getScene(this.currentScene)}});
GE.Color=GE.Klass({$name:"Color",$statics:{red:function(){return(new GE.Color).rgb(255,0,0)},green:function(){return(new GE.Color).rgb(0,255,0)},blue:function(){return(new GE.Color).rgb(0,0,255)},white:function(){return(new GE.Color).rgb(255,255,255)},black:function(){return new GE.Color}},r:0,g:0,b:0,a:1,initialize:function(){},rgba:function(a,b,c,d){this.r=a;this.g=b;this.a=d;this.b=c;return this},rgb:function(a,b,c){this.r=a;this.g=b;this.b=c;return this},ts:function(){return this.toString()},
toString:function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"}});
GE.Component=GE.Abstract(GE.EventManager,{$name:"Component",$implements:[GE.IIdentificable],$statics:{componentId:1},$abstract:{load:function(){},dispose:function(){}},__id:0,__name:null,entity:null,initialize:function(a){this.$super();this.__id=GE.Component.$static.componentId++;this.__name=a||""},isUnique:function(){return!1},getName:function(){return this.__name},setName:function(a){this.__name=a;return this},getId:function(){return this.__id},getUId:function(){return"$com("+this.$name+")"+String(this.__id)},
toString:function(){return this.getUId()}});GE.Clock=function(a){this.autoStart=void 0!==a?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1};
GE.Clock.prototype={constructor:GE.Clock,start:function(){this.oldTime=this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var a=0;this.autoStart&&!this.running&&this.start();if(this.running){var b=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),
a=0.001*(b-this.oldTime);this.oldTime=b;this.elapsedTime+=a}return a}};
GE.Entity=GE.Klass(GE.EventManager,{$name:"Entity",$type:"entity",$implements:[GE.IIdentificable],$locked:!1,__id:0,persistent:!1,scene:null,name:"",components:{},onCreate:function(){},onDelete:function(){},initialize:function(){this.__id=GE.engine.$static.incrementId()},ready:function(){},addComponent:function(a){var b=a.getId();null==this.getComponent(b)&&(this.components[b]=a,a.entity=this,a.load());return this},getComponent:function(a){if("number"===typeof a)return this.components[a];if("string"===
typeof a){var b=null,c=a.toLowerCase();this.eachComponent(function(a){null===b&&a.getName().toLowerCase()==c&&(b=a)});return b}throw"The param must be a string or number.";},getComponents:function(a){if("number"===typeof a)return[this.components[a]];if("string"===typeof a){var b=[],c=a.toLowerCase();this.eachComponent(function(a){a.getName().toLowerCase()==c&&b.push(a)});return b}throw"The param must be a string or number.";},getComponentsFromType:function(a){if("string"===typeof a&&a){var b=[],c=
a.toLowerCase();this.eachComponent(function(a){a.$name.toLowerCase()==c&&b.push(a)});return b}throw"The param must be a string.";},hasComponents:function(){return 0<Object.keys(this.components).length},eachComponent:function(a){for(var b in this.components)this.components.hasOwnProperty(b)&&a(this.components[b]);return this},dispose:function(){this.eachComponent(function(a){a&&a.dispose()});delete this.components;this.trigger(GE.Events.Generic.DISPOSE)},destroy:function(){this.scene.removeObject(this)},
getId:function(){return this.__id},getUId:function(){return"$entity("+this.$name+")"+String(this.__id)}});GE.Module=GE.Abstract({$name:"Module",$abstract:{load:function(a,b){},dispose:function(){}},name:"",async:!1});GE.ResourceStatus={NONE:0,SUCCESS:1,FAIL:-1};
GE.Resource=GE.Abstract(GE.EventManager,{$name:"Resource",$abstracts:{load:function(a){}},name:"",type:"generic",loaded:!1,status:GE.ResourceStatus.NONE,_resource:null,initialize:function(a){this.type=a.type||this.type;this.name=a.name||"";if(!this.name||""==this.name)throw"A resource must have a unique name.";},getRes:function(){return this._resource},success:function(a){this._resource=a;this.loaded=!0;this.status=GE.ResourceStatus.SUCCESS;this.trigger(GE.Events.Resource.LOAD_SUCCESS,this);this.trigger(GE.Events.Resource.LOAD_FINISH,
{success:!0,resource:this,result:a});return this},fail:function(a){this._resource=null;this.loaded=!0;this.status=GE.ResourceStatus.FAIL;console.warn(a);this.trigger(GE.Events.Resource.LOAD_FAIL,this);this.trigger(GE.Events.Resource.LOAD_FINISH,{success:!1,result:a,resource:this});return this},dispose:function(){this._resource=null;this.loaded=!1}});
GE.ResourceContainer=GE.Klass({$name:"ResourceContainer",$statics:{globalRes:{}},resources:{},add:function(a,b){(b?GE.ResourceContainer.$static.globalRes:this.resources)[a.name]=a},get:function(a,b){return b?GE.ResourceContainer.$static.globalRes[a]:this.resources[a]},load:function(a){a=a||{};GE.jQuery.each(this.resources,function(b,c){c.loaded||c.load(a[b])});return this},release:function(a,b){var c;c=b?GE.ResourceContainer.$static.globalRes:this.resources;c[a]&&(c[a].dispose(),delete c[a]);return this},
dispose:function(a){GE.jQuery.each(this.resources,function(a,c){c.dispose()});a&&(GE.jQuery.each(GE.ResourceContainer.$static.globalRes,function(a,c){c.dispose()}),GE.ResourceContainer.$static.globalRes={});this.resources={}}});
GE.ResourceQueue=GE.Klass(GE.EventManager,{$name:"ResourceQueue",resources:[],current:0,add:function(a,b){this.resources.push(a);var c=a.name;a.on("_loader_",this,GE.Events.Resource.LOAD_FINISH,function(a){a.success||console.warn(a.result);this.report(c)})},start:function(){this.current=0;this.loadCurrent()},report:function(a){this.current++;this.current<this.resources.length&&this.loadCurrent()},loadCurrent:function(){this.resources[this.current].load()},getProgress:function(){return 0==this.resources.length?
0:this.current/this.resources.length}});
GE.Scene=GE.Klass(GE.EventManager,{$name:"Scene",$implements:[GE.IIdentificable],name:"",resources:null,objects:{},objectsByName:{},objectsToCreate:[],objectsToDelete:[],initialize:function(){this.resources=new GE.ResourceContainer},start:function(a){a&&GE.jQuery.each(a,function(a,c){this.__addObject(c)});this.trigger(GE.Events.Scene.START);GE.engine.trigger(GE.Events.Scene.START);GE.engine.on(this,GE.Events.Engine.PREUPDATE,this.update)},update:function(){if(0<this.objectsToCreate.length){for(var a=
[],b=0;b<this.objectsToCreate.length;b++){var c=this.objectsToCreate[b];c&&(c.ready(),c.haveTrigger(GE.Events.Entity.CREATE)&&a.push(c))}this.objectsToCreate=[];for(b=0;b<a.length;b++)a[b].trigger(GE.Events.Entity.CREATE)}if(0<this.objectsToDelete.length){for(b=0;b<this.objectsToDelete.length;b++)this.__deleteObject(this.objectsToDelete[b]);this.objectsToDelete=[]}},change:function(a,b){GE.engine.trigger(GE.Events.Scene.CHANGE,GE.jQuery.extend({},b||{},{current:this,next:a}));GE.engine.off(this,GE.Events.Engine.PREUPDATE);
for(var c=this.findObjectsIf(function(a){return!a.persistent}),d=0;d<c.length;d++)this.__deleteObject(c[d],!0);var e=this.resources;setTimeout(function(){e.dispose()},10);return this.findObjectsIf(function(a){return a.persistent})},addObject:function(a){if(a.onCreate)a.onCreate();this.__addObject(a);this.objectsToCreate.push(a);return a.getId()},addObjects:function(a){for(var b=[],c=0;c<a.length;c++)b[c]=this.addObject(a[c]);return b},eachObject:function(a){for(var b in this.objects)a(this.objects[b])},
removeObject:function(a){a&&(GE.isEntity(a)&&(a=a.getId()),0>this.objectsToDelete.indexOf(a)&&this.objectsToDelete.push(a))},removeObjects:function(a){a=this.findObjects(a);for(var b=0;b<a.length;b++)this.removeObject(a[b].__id)},removeObjectsIf:function(a){a=this.findObjectsIf(a);for(var b=0;b<a.length;b++)this.removeObject(a[b])},getObject:function(a){return this.objects[a]},findObjects:function(a){a=this.objectsByName[a];return void 0==a?[]:a},findObjectsByType:function(a){return"string"===typeof a?
(a=a.toLowerCase(),this.findObjectsIf(function(a){return a.$type.toLowerCase()==typeName})):this.findObjectsIf(function(b){return dejavu.instanceOf(b,a)})},findObjectsIf:function(a){var b=[],c;for(c in this.objects){var d=this.objects[c];a(d)&&b.push(d)}return b},findObject:function(a){a=this.objectsByName[a];return"undefined"===typeof a?a:a[0]},__addObject:function(a){a&&(this.objects[a.getId()]=a,void 0==this.objectsByName[a.name]?this.objectsByName[a.name]=[a]:this.objectsByName[a.name].push(a),
a.scene=this)},__deleteObject:function(a,b){var c=GE.isEntity(a)?a:this.objects[a];if(c){b||c.trigger(GE.Events.Entity.DESTROY);var d=this.objectsByName[c.name];if(d){for(var e=0;e<d.length&&d[e].__id!=a;)e++;e<d.length&&d.splice(e,1)}c.onDelete();c.dispose();delete this.objects[a];delete c}},getId:function(){return this.name},getUId:function(){return"$scene("+this.$name+")"+this.name}});
GE.Path={combine:function(){for(var a="",b,c=0;c<arguments.length;++c)b=String(arguments[c]),a+=b,b.indexOf("/")!=b.length-1&&c<arguments.length-1&&(a+="/");a.indexOf("/")==a.length-1&&(a=a.substr(0,a.length-1));return a}};GE.Input=GE.Abstract(GE.EventManager,{$name:"Input",name:"",initialize:function(){}});GE.InputActionType={UNDEFINED:-1,BUTTON:0,AXIS:1};GE.InputAction=GE.Klass({name:"",actionType:GE.InputActionType.UNDEFINED,actionKey:null});
GE.DeviceStatus={NONE:0,PLUGGED:1,CONNECTED:1,UNPLUGGED:2,DISCONNECTED:2};GE.DeviceAxis=GE.Klass({value:{dx:0,dy:0},deadZone:0.001,initialize:function(){},set:function(a,b){this.value.dx=a;this.value.dy=b},clear:function(){this.set(0,0)},get:function(){return this.value},getX:function(){return this.value.dx},getY:function(){return this.value.dy},haveButton:function(){return!1}});
GE.InputDevice=GE.Abstract(GE.EventManager,{$name:"InputDevice",$statics:{inputDeviceId:0},$abstracts:{isPressed:function(a){},isReleased:function(a){},isUp:function(a){},isDown:function(a){}},__id:0,_status:0,__axis:[],initialize:function(){this.__id=++GE.InputDevice.$static.inputDeviceId;this._status=GE.DeviceStatus.NONE},start:function(){return this},stop:function(){return this},dispose:function(){this.stop()},countAxis:function(){return this.__axis.length},getAxis:function(a){"undefined"===typeof a&&
(a=0);return this.__axis[a]},getStatus:function(){return this._status},_addAxis:function(){this.__axis.push(new GE.DeviceAxis)},getId:function(){return"$device("+this.$name+"_"+this.__id+")"},getUId:function(){return"$device("+this.$name+"_"+this.__id+")"}});GE.InputDeviceMap=GE.Klass({_map:{},_device:null,initialize:function(a){this._device=a},add:function(a,b){var c=this._map;c[a]||(c[a]=[]);c[a].push(b)},getKeys:function(a){return this._map[a]},getDevice:function(){return this._device}});
GE.InputManager=GE.Klass(GE.EventManager,{devices:{},maps:{"default":null},initialize:function(){this.maps["default"]=new GE.InputMap},getMap:function(a){return"undefined"===typeof a?this.maps["default"]:this.maps[a]},detectDevices:function(){var a=0;GE.MouseDevice&&!this.devices.mouse&&(this.devices.mouse=(new GE.MouseDevice).start(),console.log(this.devices.mouse.getId()+" loaded."),++a);GE.KeyboardDevice&&!this.devices.keyboard&&(this.devices.keyboard=(new GE.KeyboardDevice).start(),console.log(this.devices.keyboard.getId()+
" loaded."),++a);return a},getPlayerDevice:function(a){throw"Not implemented.";}});
GE.InputMap=GE.Klass({name:"",_deviceMap:{},initialize:function(a){this.name=a||""},add:function(a,b,c){var d=this._deviceMap[a.getUId()];d||(d=new GE.InputDeviceMap(a),this._deviceMap[a.getUId()]=d);d.add(b,c)},isDown:function(a,b){return this.__test(a,"isDown",b)},isUp:function(a,b){return this.__test(a,"isUp",b)},isPressed:function(a,b){return this.__test(a,"isPressed",b)},isReleased:function(a,b){return this.__test(a,"isReleased",b)},check:function(a,b){var c="undefined"===typeof b?{deviceId:this._deviceMap}:
this._deviceMap[b],d;"string"===typeof a&&(a=[a]);GE.jQuery.each(c,function(b,c){for(var f,g=0;g<a.length;g++)if(f=a[g],d=c.getKeys(f))return!1;return!0});return!1},__test:function(a,b,c){var d,e;GE.jQuery.each("undefined"===typeof c?{deviceId:this._deviceMap}:this._deviceMap[c],function(c,f){e=f.getKeys(a);d=f.getDevice();for(var g=0;g<e.length;g++)if(d[b](e[g]))return!0});return!1}});GE.InputTypes={KEYBOARD:1,TOUCH:2,JOYSTICK:4,MOUSE:8,KINECT:16};GE.InputButtons={START:1,CANCEL:2,FIRE:3,FIRE2:4};
var KEY_UP=0,KEY_PRESSED=1,KEY_DOWN=2,KEY_RELEASED=3;GE.KeyboardDefaults={};
GE.KeyboardDevice=GE.Klass(GE.InputDevice,{$name:"KeyboardDevice",names:0,codes:0,__keys:[],__newKeys:{},__listeners:{},initialize:function(){this.$super();GE.engine.keyboard=this;this._status=GE.DeviceStatus.CONNECTED},start:function(){this.$super();this.__createEvents();this.__attachEvents();this.__loadCodes();this._addAxis();GE.engine.on(this.getUId(),this,GE.Events.Engine.POSUPDATE,function(){for(var a=0;a<this.__keys.length;a++)if(void 0==this.__newKeys[a])switch(this.__keys[a]){case KEY_PRESSED:this.__keys[a]=
KEY_DOWN;break;case KEY_RELEASED:this.__keys[a]=KEY_UP}this.__newKeys={}}.$member().bind(this));return this},stop:function(){this.$super();this.__detachEvents();return this},keycode:function(a){if("number"===typeof a)return this.names[a];a=String(a);var b=this.codes[a.toLowerCase()];if(b)return b;if(1===a.length)return a.charCodeAt(0)},isPressed:function(a){return this.__keys[this.keycode(a)]==KEY_PRESSED},isReleased:function(a){return this.__keys[this.keycode(a)]==KEY_RELEASED},isDown:function(a){return this.__keys[this.keycode(a)]==
KEY_DOWN},isUp:function(a){return this.__keys[this.keycode(a)]==KEY_UP},__loadCodes:function(){for(var a={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,windows:91,"right click":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,
".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},b=97;123>b;b++)a[String.fromCharCode(b)]=b-32;for(var b=48;58>b;b++)a[b-48]=b;for(b=1;13>b;b++)a["f"+b]=b+111;for(b=0;10>b;b++)a["numpad "+b]=b+96;var c={};for(b in a)c[a[b]]=b;for(b=0;255>b;b++)this.__keys[b]=KEY_UP;this.codes=a;this.names=c},__createEvents:function(){this.__listeners.keydown=function(a){GE.engine.keyboard.__onKeyDown(a)}.$member();this.__listeners.keyup=function(a){GE.engine.keyboard.__onKeyUp(a)}.$member()},__attachEvents:function(){try{GE.jQuery.each(this.__listeners,
function(a,c){document.addEventListener(a,c,!1)})}catch(a){console.log("Error loading "+this.getId()+" "+a)}},__detachEvents:function(){try{GE.jQuery.each(this.__listeners,function(a,c){document.removeEventListener(a,c,!1)}),this.__listeners={}}catch(a){console.log("Error unloading "+this.getId()+" "+a)}},__onKeyDown:function(a){var b=this.__keys[a.keyCode];if(b==KEY_UP||b==KEY_RELEASED)b=KEY_PRESSED,this.__keys[a.keyCode]=b},__onKeyUp:function(a){var b=this.__keys[a.keyCode];if(b==KEY_DOWN||b==KEY_PRESSED)b=
KEY_RELEASED,this.__keys[a.keyCode]=b}});GE.MB={NONE:0,LEFT:1,MIDDLE:2,RIGHT:3};GE.MouseButton=GE.MB;GE.MA={UP:0,PRESSED:1,DOWN:2,RELEASED:3};GE.MouseAction=GE.MA;
GE.MouseDevice=GE.Klass(GE.InputDevice,{$name:"MouseDevice",_oldX:0,_oldY:0,x:0,y:0,__timeoutAxis:null,__buttonStatus:null,initialize:function(){this.$super();GE.engine.mouse=this;this._status=GE.DeviceStatus.CONNECTED;this.__buttonStatus=[GE.MA.UP,GE.MA.UP,GE.MA.UP];this.__attachEvents()},start:function(){this.$super();this._addAxis();GE.engine.on(this.getId(),this,GE.Events.Engine.POSUPDATE,function(){for(var a=0;a<this.__buttonStatus.length;a++)switch(this.__buttonStatus[a]){case GE.MA.PRESSED:this.__buttonStatus[a]=
GE.MA.DOWN;break;case GE.MA.RELEASED:this.__buttonStatus[a]=GE.MA.UP}}.$member().bind(this));return this},stop:function(){this.$super();return this},clearAxis:function(){this.getAxis(0).clear();this.__timeoutAxis=null},getPosition:function(){return{x:this.x,y:this.y}},isLeftDown:function(){return this.isDown(GE.MB.LEFT)},isRightDown:function(){return this.isDown(GE.MB.RIGHT)},isPressed:function(a){return this.__buttonStatus[a]==GE.MA.PRESSED},isReleased:function(a){return this.__buttonStatus[a]==
GE.MA.RELEASED},isDown:function(a){return this.__buttonStatus[a]==GE.MA.DOWN},isUp:function(a){return this.__buttonStatus[a]==GE.MA.UP},__onMouseDown:function(a){a=this.__getButton(a);var b=this.__buttonStatus[a];if(b==GE.MA.UP||b==GE.MA.RELEASED)b=GE.MA.PRESSED,this.__buttonStatus[a]=b},__onMouseUp:function(a){a=this.__getButton(a);var b=this.__buttonStatus[a];if(b==GE.MA.DOWN||b==GE.MA.PRESSED)b=GE.MA.RELEASED,this.__buttonStatus[a]=b},__onMouseMove:function(a){a.preventDefault();this._oldX=this.x;
this._oldY=this.y;this.x=2*(a.clientX/window.innerWidth)-1;this.y=2*-(a.clientY/window.innerHeight)+1;var b=this;if(this.__timeoutAxis){clearTimeout(this.__timeoutAxis);a=Math.sign(this.x-this._oldX);var c=Math.sign(this.y-this._oldY);this.getAxis(0).set(a,c)}this.__timeoutAxis=setTimeout(function(){b.clearAxis()},30)},__attachEvents:function(){document.addEventListener("mousemove",function(a){GE.engine.mouse.__onMouseMove(a)}.$member(),!1);document.addEventListener("mousedown",function(a){GE.engine.mouse.__onMouseDown(a)}.$member(),
!1);document.addEventListener("mouseup",function(a){GE.engine.mouse.__onMouseUp(a)}.$member(),!1)},__getButton:function(a){if("which"in a)return a.which;if("button"in a){if(a.button&1)return GE.MB.LEFT;if(a.button&2)return GE.MB.RIGHT;if(a.button&4)return GE.MB.MIDDLE}return GE.MB.NONE}});
